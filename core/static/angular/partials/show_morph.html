<div id="twoway">
    <div class="wrapper">
        <h3>Stats</h3>
        <p><strong>Morph gender:</strong> {{morph.fields.gender}}</p>
        <p><strong>Morph species text:</strong> {{morph.fields.species_text}}</p>
        <p><strong>Morph species category:</strong> {{morph.fields.species_category}}</p>
        <p><strong>Morph owner:</strong> <a href="/~{{morph.fields.user}}">{{morph.fields.user}}</a></p>
        <ng:switch on="morph.is_owner"><div ng:switch-when="true">
            <p class="addLink"><a href="/morph/{{morph.fields.id}}/edit">Edit this morph</a></p>
            <p class="addLink"><a href="javascript:void(0)" onclick="$('#imageBay').dialog(ibDialogOptions);">Attach image</a></p>
        </div></ng:switch>
        <p class="small">Permalink: <a href="http://c.o-f.co/m/{{morph.fields.id}}">http://c.o-f.co/m/{{morph.fields.id}}</a></p>
    </div>
    <div class="wrapper">
        <h3>Descriptions</h3>
        <p ng:repeat="description in morph.descriptions"><a href="#/description/{{description.id}}">{{description.name}}</a> ({{description.rating}})
        <ng:switch on="morph.is_owner"><span ng:switch-when="true"> - <a href="/description/{{description.id}}/delete">[X]</a></span></ng:switch></p>
        <ng:switch on="morph.is_owner"><div ng:switch-when="true">
            <hr />
            <p class="addLink"><a href="javascript:void(0)" onclick="$('#createDescription').dialog('open')">+ Add description</a></p>
            <div id="createDescription" title="Create description">
                <form method="post" action="/description/create/">
                    <div class="ntn"></div>
                    <input id="morphidfld" type="hidden" name="morph" value="{{morph.fields.id}}" />
                    <table>
                        <tr>
                            <th><label for="name">Name:</label></th>
                            <td><input type="text" name="name" /></td>
                        </tr>
                        <tr>
                            <th><label for="description">Description:</label></th>
                            <td><textarea rows="10" cols="50" name="description"></textarea></td>
                        </tr>
                        <tr>
                            <th><label for="rating">Rating:</label></th>
                            <td>
                                <select name="rating">
                                    <option value="G">General</option>
                                    <option value="M">Mature</option>
                                    <option value="R">Adult</option>
                                </select>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2"><input type="submit" value="Create description" /></td>
                        </tr>
                    </table>
                </form>
            </div>
        </div></ng:switch>
    </div>
    <div style="clear: left">
        <h3>Images</h3>
        <div ng:repeat="image in morph.images" class="wrapper galleryThumb">
            <a href="#/image/{{image.image_id}}"><img class="thumb{{image.rating}}" ng:src="{{image.thumbnail}}" alt="{{image.attribution}}" /></a><br />
            {{image.caption}}
            <ng:switch on="morph.is_owner"><a ng:switch-when="true" href="/image/{{image.id}}/detach/">[X]</a></ng:switch>
        </div>
    </div>
</div>
<ng:switch on="morph.is_owner"><div ng:switch-when="true">
    <div id="imageBay" title="Attach an image" style="display: none">
        <div ng:repeat="image in images">
            <form method="post" action="/image/{{image.pk}}/attach/">
                <div class="ntn"></div>
                <input type="hidden" name="content_type" value="{{morph.content_type_id}}" />
                <input type="hidden" name="object_id" value="{{morph.fields.id}}" />
                <p><input type="image" ng:src="/media/{{image.fields.thumbnail}}" alt="Attach image" /></p>
                <p><strong>Caption:</strong> <input type="text" name="caption" /></p>
                <hr />
            </form>
        </div>
    </div>
</div></ng:switch>
<script type="text/javascript">
    var ibDialogOptions = { 
        width: 300,
        height: 400,
        modal: true
    };
    $(document).ready(function() {
        $('.ntn').append($('#nnt').html());
        $('#createDescription').dialog({ 
            autoOpen: false,
            width: 600,
            height: 400,
            modal: true
        });
    });
</script>
